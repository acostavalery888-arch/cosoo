<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Marcador Fútbol</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <style>
        /* Estilos CSS aquí... */
    </style>
</head>
<body>
    <nav class="navbar navbar-dark mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <img src="https://placehold.co/30x30" alt="Icono de la aplicación con un diseño de marcador de fútbol" class="me-2">
                Control Marcador
            </span>
            <div class="connection-status">
                <span class="status-indicator disconnected" id="connection-status"></span>
                <span id="connection-text">Desconectado</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="tabs-container">
            <div class="tab active" data-tab="control">Control</div>
            <div class="tab" data-tab="stats">Estadísticas</div>
            <div class="tab" data-tab="settings">Configuración</div>
        </div>

        <div class="tab-content active" id="control-tab">
            <div class="card device-card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Estado del Marcador</span>
                    <button class="btn btn-sm btn-primary" id="refresh-btn">
                        <img src="https://placehold.co/15x15" alt="Icono de actualizar">
                    </button>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Equipo Local</label>
                            <input type="text" class="form-control" id="local-team" value="Locales">
                        </div>
                        <div class="col">
                            <label class="form-label">Equipo Visitante</label>
                            <input type="text" class="form-control" id="visitor-team" value="Visitantes">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col text-center">
                            <div class="mb-2">Marcador Actual</div>
                            <div class="d-flex justify-content-center align-items-center">
                                <div class="me-3">
                                    <button class="btn btn-primary" id="decrease-local">-</button>
                                </div>
                                <h2 id="score-display">0 - 0</h2>
                                <div class="ms-3">
                                    <button class="btn btn-primary" id="decrease-visitor">-</button>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center mt-2">
                                <div class="me-3">
                                    <button class="btn btn-primary" id="increase-local">+</button>
                                </div>
                                <div class="ms-3">
                                    <button class="btn btn-primary" id="increase-visitor">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Tiempo de Juego</label>
                            <select class="form-select" id="match-period">
                                <option value="1">Primer Tiempo</option>
                                <option value="2">Segundo Tiempo</option>
                                <option value="3">Tiempo Extra</option>
                                <option value="4">Penales</option>
                            </select>
                        </div>
                        <div class="col">
                            <label class="form-label">Minuto</label>
                            <input type="number" class="form-control" id="match-minute" min="0" max="120" value="0">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col">
                            <button class="btn btn-goal w-100 mb-2" id="local-goal">GOL LOCAL</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-goal w-100" id="visitor-goal">GOL VISITA</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card device-card mb-4">
                <div class="card-header">Sensores Ambientales</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col">
                            <div class="text-center">
                                <div class="device-icon">
                                    <img src="https://placehold.co/30x30" alt="Icono de termómetro">
                                </div>
                                <div>Temperatura</div>
                                <div class="sensor-value" id="temperature-value">24°C</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="text-center">
                                <div class="device-icon">
                                    <img src="https://placehold.co/30x30" alt="Icono de gota de humedad">
                                </div>
                                <div>Humedad</div>
                                <div class="sensor-value" id="humidity-value">65%</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="text-center">
                                <div class="device-icon">
                                    <img src="https://placehold.co/30x30" alt="Icono de reloj">
                                </div>
                                <div>Hora Actual</div>
                                <div class="sensor-value" id="current-time">15:30</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card device-card">
                <div class="card-header">Acciones Rápidas</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <button class="btn btn-primary w-100" id="reset-match">Resetear Partido</button>
                        </div>
                        <div class="col-md-4 mb-2">
                            <button class="btn btn-primary w-100" id="pause-match">Pausar Tiempo</button>
                        </div>
                        <div class="col-md-4 mb-2">
                            <button class="btn btn-primary w-100" id="save-match">Guardar Partido</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="stats-tab">
            <div class="card mb-4">
                <div class="card-header">MVP del Partido</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Jugador Destacado</label>
                        <input type="text" class="form-control" id="mvp-player" placeholder="Nombre del jugador">
                    </div>
                    <button class="btn btn-primary" id="set-mvp">Establecer MVP</button>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header">Historial de Goles</div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush" id="goal-history">
                        <div class="list-group-item history-item">
                            <div class="d-flex justify-content-between">
                                <span>Equipo Local</span>
                                <span class="goal-time">45'</span>
                            </div>
                        </div>
                        <div class="list-group-item history-item">
                            <div class="d-flex justify-content-between">
                                <span>Equipo Visitante</span>
                                <span class="goal-time">68'</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">Datos Estadísticos</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col">
                            <div class="mb-3">
                                <div>Posesión Local:</div>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 55%;">55%</div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div>Tiros al arco:</div>
                                <div>
                                    <span class="badge bg-primary">Local: 8</span>
                                    <span class="badge bg-danger ms-2">Visita: 5</span>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <div>Faltas cometidas:</div>
                                <div>
                                    <span class="badge bg-primary">Local: 12</span>
                                    <span class="badge bg-danger ms-2">Visita: 15</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div>Tarjetas:</div>
                                <div>
                                    <span class="badge bg-warning text-dark">Amarillas: 4</span>
                                    <span class="badge bg-dark ms-2">Rojas: 1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="settings-tab">
            <div class="card mb-4">
                <div class="card-header">Conexión del Dispositivo</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Método de Conexión</label>
                        <select class="form-select" id="connection-method">
                            <option value="bluetooth">Bluetooth</option>
                            <option value="wifi">WiFi</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="wifi-settings">
                        <label class="form-label">Dirección IP del ESP32</label>
                        <input type="text" class="form-control" id="esp-ip" placeholder="192.168.1.100">
                    </div>
                    
                    <div class="mb-3 d-none" id="bluetooth-settings">
                        <label class="form-label">Dispositivos Bluetooth</label>
                        <select class="form-select" id="bt-devices">
                            <option>Buscando dispositivos...</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary w-100" id="connect-btn">Conectar</button>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header">Configuración del Marcador</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Brillo de la matriz LED</label>
                        <input type="range" class="form-range" id="brightness" min="0" max="15" value="8">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Velocidad de desplazamiento</label>
                        <select class="form-select" id="scroll-speed">
                            <option value="slow">Lento</option>
                            <option value="medium" selected>Medio</option>
                            <option value="fast">Rápido</option>
                        </select>
                    </div>
                    
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="show-sensors" checked>
                        <label class="form-check-label" for="show-sensors">Mostrar datos de sensores</label>
                    </div>
                    
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="show-time" checked>
                        <label class="form-check-label" for="show-time">Mostrar hora actual</label>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">Conexión a Base de Datos</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">URL del Servidor</label>
                        <input type="text" class="form-control" id="db-url" placeholder="https://tuservidor.com/api">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Token de Acceso</label>
                        <input type="password" class="form-control" id="db-token" placeholder="Token de autenticación">
                    </div>
                    
                    <button class="btn btn-primary" id="test-connection">Probar Conexión</button>
                </div>
            </div>
        </div>
    </div>

    <div id="notification"></div>

    <div class="footer">
        <button class="btn btn-primary" id="save-all">Guardar Configuración</button>
    </div>

    <script>
        // Variables de estado
        let isConnected = false;
        let localScore = 0;
        let visitorScore = 0;
        let matchTime = 0;
        let matchPeriod = 1;
        let isTimerRunning = false;
        let timerInterval;
        let goalHistory = [];
        
        // Elementos del DOM
        const connectionStatus = document.getElementById('connection-status');
        const connectionText = document.getElementById('connection-text');
        const temperatureValue = document.getElementById('temperature-value');
        const humidityValue = document.getElementById('humidity-value');
        const currentTime = document.getElementById('current-time');
        const scoreDisplay = document.getElementById('score-display');
        
        // Función para enviar datos al ESP32
        async function enviarDatosAlESP32() {
            const datos = {
                equipoA: document.getElementById('local-team').value,
                equipoB: document.getElementById('visitor-team').value,
                golesA: parseInt(document.getElementById('local-score').value),
                golesB: parseInt(document.getElementById('visitor-score').value),
                periodo: parseInt(document.getElementById('match-period').value),
                mvp: document.getElementById('mvp-player').value
            };

            try {
                const ipESP32 = "192.168.1.100"; // CAMBIA ESTO por la IP que anotaste del ESP32
                const respuesta = await fetch(`http://${ipESP32}/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
                console.log("Datos enviados:", datos);
            } catch (error) {
                console.error("Error al enviar:", error);
            }
        }
        
        // Funciones para actualizar el marcador
        function updateScoreDisplay() {
            scoreDisplay.textContent = `${localScore} - ${visitorScore}`;
        }
        
        function updateTimeDisplay() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            currentTime.textContent = `${hours}:${minutes}`;
        }
        
        function updateSensorValues() {
            // Simular lectura de sensores (en la app real obtendrías estos valores del ESP32)
            temperatureValue.textContent = `${Math.floor(Math.random() * 5) + 22}°C`;
            humidityValue.textContent = `${Math.floor(Math.random() * 10) + 60}%`;
        }
        
        // Manejo de eventos
        document.getElementById('increase-local').addEventListener('click', () => {
            localScore++;
            updateScoreDisplay();
            enviarDatosAlESP32(); // Llama a la función para enviar datos
        });
        
        document.getElementById('decrease-local').addEventListener('click', () => {
            if (localScore > 0) {
                localScore--;
                updateScoreDisplay();
                enviarDatosAlESP32(); // Llama a la función para enviar datos
            }
        });
        
        document.getElementById('increase-visitor').addEventListener('click', () => {
            visitorScore++;
            updateScoreDisplay();
            enviarDatosAlESP32(); // Llama a la función para enviar datos
        });
        
        document.getElementById('decrease-visitor').addEventListener('click', () => {
            if (visitorScore > 0) {
                visitorScore--;
                updateScoreDisplay();
                enviarDatosAlESP32(); // Llama a la función para enviar datos
            }
        });
        
        document.getElementById('local-goal').addEventListener('click', () => {
            localScore++;
            updateScoreDisplay();
            enviarDatosAlESP32(); // Llama a la función para enviar datos
        });
        
        document.getElementById('visitor-goal').addEventListener('click', () => {
            visitorScore++;
            updateScoreDisplay();
            enviarDatosAlESP32(); // Llama a la función para enviar datos
        });
        
        document.getElementById('set-mvp').addEventListener('click', () => {
            mvp = document.getElementById('mvp-player').value;
            enviarDatosAlESP32(); // Llama a la función para enviar datos
        });
        
        // Manejo de tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
